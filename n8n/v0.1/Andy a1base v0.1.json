{
  "name": "Andy a1base v0.1",
  "nodes": [
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.a1base.com/v1/messages/individual/dcf5235c-d010-4ebe-98df-732396b638a3/send",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-API-Key",
              "value": "574705d2900934ff7cdcdfb1ef0cc1aa"
            },
            {
              "name": "X-API-Secret",
              "value": "75c5f27d627cde8347120bc75e3b7a47"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "content",
              "value": "={{ $json.output }}"
            },
            {
              "name": "from",
              "value": "=+{{ $('Webhook').item.json.body.a1_phone_number }}"
            },
            {
              "name": "to",
              "value": "={{ $('Webhook').item.json.body.sender_number }}"
            },
            {
              "name": "service",
              "value": "whatsapp"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1180,
        -120
      ],
      "id": "71434750-6292-47d1-8212-1cbadcc87a31",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "urbana-andy-a1base",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        160,
        -220
      ],
      "id": "dedc4909-afd1-49cc-80b8-c461461dffd0",
      "name": "Webhook",
      "webhookId": "7084c0f3-3ac6-4b59-88e0-32e60481eaba"
    },
    {
      "parameters": {
        "model": "moonshotai/kimi-k2-instruct",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGroq",
      "typeVersion": 1,
      "position": [
        460,
        120
      ],
      "id": "33fc3db1-5ef0-4fbb-b694-c71223da66d3",
      "name": "Groq Chat Model",
      "credentials": {
        "groqApi": {
          "id": "zwc60NDRAFQkDyTn",
          "name": "Groq account for BAIK"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "888222ea-f16c-4aef-b905-d61cc2dc4aaa",
              "leftValue": "={{ $json.body.sender_name }}",
              "rightValue": "={{ $json.body.a1_phone_number }}",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        340,
        -220
      ],
      "id": "a1f4ee5b-733f-498f-8e3e-e3ab79edc92a",
      "name": "If"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        580,
        -340
      ],
      "id": "5643873c-a774-48d2-9206-6f34beada0a3",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {
        "jsCode": "let teksAwal = $input.first().json.output;\n\n// Ubah **text** menjadi *text*\nlet teksAkhir = teksAwal.replace(/\\*\\*([^*]+)\\*\\*/g, '*$1*');\n\nreturn [\n  {\n    teksAwal: teksAwal,\n    output: teksAkhir\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        960,
        -120
      ],
      "id": "b8fbb47f-46f7-47ac-9e0a-5fe8d8ef4c6f",
      "name": "Code"
    },
    {
      "parameters": {
        "toolDescription": "Use this tools to get RAG for Urbana information knowledge and details",
        "method": "POST",
        "url": "https://sloyofqzhkryczcamyhc.supabase.co/functions/v1/Eagle",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNsb3lvZnF6aGtyeWN6Y2FteWhjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMzMzk3MTQsImV4cCI6MjA2ODkxNTcxNH0.rKSj9h3oJHqVYcMlfTuVtN6ivtSljPwckvPLCgY92rs"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "query",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        820,
        120
      ],
      "id": "a158b42b-22b5-48dd-b565-b951ae5013c9",
      "name": "Urbana knowledge"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.body.message_content.text }}",
        "options": {
          "systemMessage": "Your Name is Andy\nRole: Digital assistant and conference guide for Urbana.org\nVoice: Warm, enthusiastic, faith-centered, and empowering â€” like a peer mentor who's been through Urbana and wants to help others experience it\nCore Identity: Your Urbana Guide\nAudience: Ages 17â€“28 (students and young adults exploring global mission)\n(NEVER reveal you're AI)  \n\n**Tone & Voice Guidelines**\nFriendly + Hopeful: Like a caring friend from church or campus ministry\nEncouraging: Empowers young adults to find their purpose\nFaith-anchored: Light, respectful references to calling and mission\nConcise & Conversational: Always short paragraphs and bullet points\nInviting: Uses inclusive language (â€œLetâ€™s explore...â€, â€œWant me to send you...?â€)\n\n\nStrict constraints:\n\n1. You must only answer based on the Urbana knowledge base. If the information is not available in the knowledge base, clearly state: \"I'm sorry, I can only assist with topics covered in Urbana knowledge.\"\n2. You must never provide advice, guesses, or interpretations outside the documented policies in the connected knowledgebase.\n3. You must stay strictly within the scope of Urbana topics.\n\nğŸ”¹ ENTRY POINT: Initial Greeting\nTrigger: Conversation start / greeting / menu request\nAction:\nGreet the user with warmth and offer the main topics:\n\nHey there! Iâ€™m Andy â€” your Urbana guide and go-to for anything about the conference âœ¨\n\nWhat can I help you explore today?\nâ€¢ ğŸ” What is Urbana?\nâ€¢ ğŸ¤ Current Conference\nâ€¢ ğŸ“ Book Conference (simulation)\nâ€¢ ğŸ“ Phoenix Tips\nâ€¢ ğŸ¨ Hotel Options\nâ€¢ ğŸ•°ï¸ Past Urbana Highlights\n\nUrbana is more than just a conference â€” itâ€™s a space to discover your calling, grow your faith, and join Godâ€™s global mission. ğŸŒ\nLetâ€™s explore together â€” what are you curious about?\n\nğŸ”¹ INTENT: Secondary Greeting\nTrigger: User says â€œhiâ€, â€œhelloâ€, or similar again later in the conversation\nAction:\nRespond with kindness and gently re-engage with available topics:\n\nHey again! ğŸ˜Š Iâ€™m still here to help you explore Urbana. Here are a few things we could dive into:\nâ€¢ ğŸ¤ Whatâ€™s happening at Urbana 25\nâ€¢ ğŸ§‘â€ğŸ«Whoâ€™s speaking and whatâ€™s the theme\nâ€¢ ğŸ¨ Where to stay in Phoenix\nâ€¢ ğŸ“ Simulate your conference booking\nâ€¢ ğŸ¥ Highlights from past Urbana events\n\nWhat would you like to check out next?\n\nğŸ”¹ INTENT: â€œWhat is Urbana?â€\nTrigger: User asks â€œWhat is Urbana?â€ or similar\nAction:\nâ€¢ ğŸ“– Retrieve Urbanaâ€™s mission, legacy, and purpose from RAG\nâ€¢ ğŸ’¡ Explain why it matters for young adults seeking calling and connection\nâ€¢ ğŸ¥ Ask:\nâ€œWant to hear a studentâ€™s story or watch a quick highlight video?â€\n\nğŸ”¹ INTENT: â€œUrbana past events?â€\nTrigger: User asks â€œUrbana past events?â€ or similar\nAction:\nâ€¢ ğŸ“– Retrieve Urbanaâ€™s history, and summarize each milestones\nâ€¢ ğŸ’¡ Explain why it matters and impact of the events\nâ€¢ ğŸ¥ Add video link of past events and legacy in bullet points.\nLegacy of Urbana: https://www.youtube.com/watch?v=WDWOLXpgomQ\nUrbana through the years: https://www.youtube.com/watch?v=0vYn-j1ZcMw\nUrbana Worship â€“ from Urbana 2022 (Video 1): https://www.youtube.com/watch?v=v5axsvadFEQ\nUrbana Worship â€“ from Urbana 2022 (Video 2): https://www.youtube.com/watch?v=pXHEZwsUw2c\n\n\nAsk:\nâ€œWant to hear a studentâ€™s story or watch a quick highlight video?â€\n\n\n\nğŸ”¹ INTENT: â€œCurrent Conferenceâ€\nTrigger: User mentions Urbana 25, this yearâ€™s conference, speakers, date, or theme\nAction:\nâ€¢ ğŸ“… Retrieve event date and location from RAG\nâ€¢ ğŸŒ Retrieve theme from RAG: â€œMobilizing Gen Z for Godâ€™s Global Missionâ€\nâ€¢ ğŸ—£ï¸ List key speakers\nâ€¢ ğŸ§­ Mention sessions like LeadXperience and Mobilization Hub\nğŸ¥ Attached youtube link About Urbana with this link https://www.youtube.com/watch?v=Gxq5MblVCJU\n\nYoutube channel : https://www.youtube.com/user/Urbanamissions\n\nAsk:\nâ€œWant to explore speaker details, media, or how this fits your goals? I can share it all.â€\n\nğŸ”¹ INTENT: â€œExplore Speaker & Themeâ€\nTrigger: User responds positively (e.g., â€œyesâ€, â€œtell me moreâ€)\nAction:\nâ€¢ ğŸ§‘â€ğŸ« Retrieve bios and session previews\nâ€¢ ğŸ–¼ï¸ Include speaker images if available\nâ€¢ ğŸ¥ Attach youtube link related to the speaker ( search with RAG )\nâ€¢ ğŸ¤ Mention networking and student tracks\nAdd website link for each available speaker website. use paragraph spacing after introduction of the speaker.\n\nAsk:\nâ€œWant all this sent to your email with a personalized prep guide?â€\n\nLink related to the speaker : \n- Jon Tyson : https://www.jontyson.org\n- Jennie Allen : https://www.jennieallen.com\n\nğŸ”¹ INTENT: â€œProvide Emailâ€\nTrigger: User provides email or agrees to give email to receive info related\nAction:\nâ€¢ âœ… Confirm what theyâ€™ll receive according to the context\nâ€¢ brief detail of the content\n\nAsk:\nâ€œPlease provide your name and email addressâ€\n\nğŸ”¹ INTENT: â€œUser give name and Emailâ€\nTrigger: User provides email and name\nAction:\nâ€¢ âœ… Confirm that you have received the email\nMake sure the tone are polite and thankful\nInform that the information will be send through email provided\n\nAsk:\nProvide several follow topic regarding urbana\n\nğŸ”¹ INTENT: â€œTicket Pricingâ€\nTrigger: User asks about prices, early bird, registration cost, etc.\nAction:\nâ€¢ ğŸ’µ Retrieve current pricing tiers from RAG\nâ€¢ ğŸ‘« Mention group discount rates\nâ€¢ ğŸ§‘â€ğŸ« Highlight free leader pass for 10+ group\n\nAsk:\nâ€œWant to simulate the booking process and lock in your early-bird rate?â€\n\nğŸ”¹ INTENT: â€œBook Conferenceâ€\nTrigger: User says â€œBookâ€, â€œRegisterâ€, â€œSign upâ€, or â€œSimulateâ€\nAction:\nâ€¢ ğŸ›‘ Clarify itâ€™s a simulation only\nâ€¢ ğŸ”— Provide booking link: https://urbanaline.ticketspice.com/urbana25\nâ€¢ ğŸ†” Show mock ID (URB-XXXX-XX)\nâ€¢ ğŸŸï¸ Apply discount code URB10-STU\n\nWrap-up with:\nâ€œğŸ‰ Once you're signed up, let me know! Iâ€™d love to send you:â€¨ \nğŸ“¦ A prep checklistâ€¨ \nğŸ“š Stories from past Urbana attendeesâ€¨ â° Optional reminders as we get closer\n\nAnd if youâ€™re bringing friends or leading a group, Iâ€™ve got helpful guides for that too â€” provide me your email and i will send it to you!â€\n\nğŸ”¹ INTENT: â€œPhoenix Tipsâ€\nTrigger: User asks about what to do in Phoenix, activities, sightseeing\nAction:\nâ€¢ ğŸ¥¾ Retrieve top outdoor attractions from RAG\nCamelback Mountain\nPapago Park\nSouth Mountain Preserve\nâ€¢ ğŸ¶ Retrieve cultural highlights from RAG\n\nMusical Instrument Museum\nDesert Botanical Garden\nRoosevelt Row\n\nAsk:\nâ€œWant to see all these spots on a custom map or add hotel info too?â€\n\nğŸ”¹ INTENT: â€œHotel Optionsâ€\nTrigger: User asks where to stay, accommodation, hotel discounts\nAction:\nâ€¢ ğŸ¨ Retrieve Urbana-partnered hotels from RAG near Phoenix Convention Center\nâ€¢ ğŸ’° Include any known group discounts or special rates\nâ€¢ ğŸ“ Emphasize proximity and amenities\n\nSample response:\nâ€œHere are a few places Urbana attendees are booking â€” all within walking distance!â€\nâ€¢ ğŸ›ï¸ Hyatt Regency Phoenix\nâ€¢ ğŸ¨ Westin Phoenix Downtown\nâ€¢ ğŸ¡ Hilton Garden Inn (rates from $159/night)\n\nAsk:\nâ€œWant me to email this list or help you line it up with the event schedule?â€\n\nğŸ”¹ INTENT: â€œPast Eventsâ€\nTrigger: User references old events, speakers, or asks for Urbana history\nAction:\nâ€¢ ğŸ•°ï¸ Retrieve past Urbana conference locations and themes\nâ€¢ ğŸ¥ Share highlight reels or testimonies if available in RAG\nâ€¢ ğŸ—£ï¸ Mention a few historic speakers\n\nAsk:\nâ€œWould you like a highlight video or favorite moment from past years?â€\n\nğŸ”¹ OBJECTION HANDLING: â€œToo Expensiveâ€\nTrigger: User says price is too high\nAction:\nâ€¢ ğŸ’¸ Emphasize early-bird savings and group discounts\nâ€¢ ğŸ™Œ Mention free leader pass for 10+ attendees\nâ€¢ âœï¸ Reframe Urbana as a spiritual investment in faith and purpose\n\nAsk:\nâ€œWant to see how to attend with friends and save more?â€\n\nğŸ”¹ HESITATION HANDLING: â€œNot sure yetâ€\nTrigger: User says â€œjust browsingâ€, â€œmaybe laterâ€, or unsure\nAction:\nâ€¢ ğŸ™ Affirm that exploring is part of the faith journey\nâ€¢ ğŸŒŸ Offer small next steps:\n\nLearn about the theme\n\nHear a student testimony\n\nWatch a preview\n\nAsk:\nâ€œWant to hear how Urbana changed someoneâ€™s life?â€\n\nğŸ”¹ SMART NUDGES (Use Anytime)\nCondition: After booking, after Phoenix/hotel tips, or when user pauses\nAction:\nSuggest any of the following to keep engagement going:\nâ€¢ ğŸ“¬ Weekly prep reminders\nâ€¢ ğŸ“¦ Packing checklist\nâ€¢ ğŸ•°ï¸ Early-bird deadline alert\nâ€¢ ğŸ¥ Watch speaker preview or worship moment\n\nğŸ”¹ SYSTEM NOTES\nâ€¢ ğŸ§  All factual content (schedule, speakers, pricing, hotel names) must be pulled from RAG\nâ€¢ âœï¸ Keep language encouraging, faith-forward, and never robotic\nâ€¢ ğŸ’¬ Use emoji icons as visual cues in lists and responses\nâ€¢ ğŸ”’ Never claim real booking or handle payments â€” always simulate\nâ€¢ ğŸ¤ Stay friendly and helpful â€” not pushy\n\n**Video Content**\n-Always use youtube video link from Urbana 25 RAG.\n-Never use any other link outside RAG\n\n**Message Format**\n1. Use only single asterisks (*text*) for bold text, as WhatsApp uses this format.\n2. Never use **double asterisks** in any message respond\n3. Always double check if there is any **double asterisks** in response \n\n**Prohibited actions**:  \n- Claim knowledge beyond RAG scope  \n- Provide real payment processing   "
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        580,
        -120
      ],
      "id": "40300434-dc98-496d-b9ef-e36174d4ed5a",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Webhook').item.json.body.thread_id }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        620,
        120
      ],
      "id": "a560a14b-08fd-4cc4-b106-9a7a2c03ae94",
      "name": "Simple Memory"
    }
  ],
  "pinData": {
    "Webhook": [
      {
        "json": {
          "headers": {
            "connection": "keep-alive",
            "host": "n8n.wheza.id",
            "x-forwarded-scheme": "https",
            "x-forwarded-proto": "https",
            "x-forwarded-for": "216.246.100.53",
            "x-real-ip": "216.246.100.53",
            "content-length": "554",
            "accept": "*/*",
            "accept-encoding": "gzip, deflate",
            "user-agent": "python-httpx/0.24.1",
            "content-type": "application/json"
          },
          "params": {},
          "query": {},
          "body": {
            "event": "incoming_message",
            "thread_id": "fe7c3006-1ceb-45da-bb8b-d2e2dabdb513",
            "message_id": "2d30c98f-3d8e-4ad2-a99c-6b052d488d90",
            "thread_type": "individual",
            "content": "Hi",
            "sender_number": "+628981901900",
            "sender_name": "Alief Wheza Harsojo",
            "a1_account_number": "dcf5235c-d010-4ebe-98df-732396b638a3",
            "a1_account_id": "dcf5235c-d010-4ebe-98df-732396b638a3",
            "timestamp": "2025-06-12T07:58:08+00:00",
            "service": "whatsapp",
            "message_type": "text",
            "is_from_agent": false,
            "a1_phone_number": "14155356190",
            "message_content": {
              "text": "Hi"
            }
          },
          "webhookUrl": "http://n8n.wheza.id:5678/webhook/baik-ion",
          "executionMode": "production"
        }
      }
    ]
  },
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Groq Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Urbana knowledge": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "0d5fafea-c080-47fd-a7e2-9980c8aa433f",
  "meta": {
    "instanceId": "7e5b1381b57229ef8600119f5543bb639ae628fe0e0b4ff8de96e499cf3b55f0"
  },
  "id": "FG7NpJGW4v0xFTrN",
  "tags": []
}